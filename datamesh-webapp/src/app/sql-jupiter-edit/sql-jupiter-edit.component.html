<div class="ids">
    parentCollection:{{ parentCollection }}
    collection:{{ collection }}
    id:{{ id }}
</div>

<div *ngIf="sqlJupiter" [formGroup]="FG" >
    <div class="header">

        <button *ngIf="!activeStatuses.has(sqlJupiter.request_status)" mat-raised-button color="primary" [disabled]="submitting" (click)="onExecute()">ExecuteSql</button>
        <button *ngIf="activeStatuses.has(sqlJupiter.request_status)" mat-raised-button color="warn" [disabled]="submitting" (click)="onAbort()">Abort</button>
        <mat-form-field class="dataset" appearance="fill">
            <mat-label>connection </mat-label> 
            <mat-select formControlName="connectionId" [value]="sqlJupiter.connectionId" (selectionChange)="onConnectionChange($event)">
                <mat-option [value]="null"></mat-option>
                <mat-option *ngFor="let connection of connections" [value]="connection.id">{{connection.label}}</mat-option>
            </mat-select>  
        </mat-form-field>          

        <button  [disabled]="submitting" (click)="onExportCsv()"><mat-icon>topic</mat-icon></button>
    </div>  
    <div *ngIf="activeStatuses.has(sqlJupiter.request_status)">
        status:{{ sqlJupiter.request_status }} request_time:{{ elapsedTime }}
        <span class="ids">
            request_id::{{ sqlJupiter.request_id }} 
        </span>
    </div>
    <div *ngIf="sqlJupiter.request_status == 'error'">
        <div class="ids">
            request_id::{{ sqlJupiter.request_id }} 
        </div>
        status:{{ sqlJupiter.request_status }} 
        <span class="error_mesage">{{ sqlJupiter.request_error_message}}</span>
    </div>    
    <div>
        <!--
        <mat-form-field class="sql" appearance="fill">
            <mat-label>sql</mat-label> 
            <textarea  class="sql" matInput rows="{{rows}}" formControlName="sql" (change)="onSqlChange($event)"></textarea> 
            
        </mat-form-field>
        -->
        <sql-edit formControlName="sql" (valueChange)="onSqlChange($event)"></sql-edit>
    </div>
    <div>
        <table *ngIf="this.sqlJupiter.result_set && this.sqlJupiter.result_metadata">
            <tr>
                <td> idx </td>
                <th *ngFor="let h of this.sqlJupiter.result_metadata">{{ h["name"] }}</th>
            </tr>
            
            <tr *ngFor="let row of this.sqlJupiter.result_set; index as i">
                <td>{{ i }}</td>
                <td *ngFor="let key of getKeys(row)">{{ row[key] }}</td> 
            </tr>
        </table>  
    </div>
  
</div>  
